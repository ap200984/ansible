---
- hosts: all
  become: true
  vars:
    docker_network_name: docker-net
    docker_network_subnet: 172.20.0.0/16
    docker_network_range: 172.20.240.0/20

  tasks:
    - name: Create a network for nginx_proxy
      become: true
      docker_network:
        name: "{{ docker_network_name }}"
        ipam_config:
          - subnet: "{{ docker_network_subnet }}"
            iprange: "{{ docker_network_range }}"

    # - name: nginx_proxy
    #   community.docker.docker_container:
    #     name: nginx_proxy
    #     image: "nginx"
    #     networks:
    #       - name: "{{ docker_network_name }}"
    #     env:
    #       PROXY_USER: "proxy"
    #       PROXY_PASSWORD: "proxy_Taran#32"
    #     ports:
    #       - 80:80/tcp
    #       - 443:443/tcp
    #     volumes:
    #       - /etc/my_proxy:/etc/nginx/conf.d:rw
    #     state: "started"
    #     restart_policy: "unless-stopped"

    - name: nginx_proxy
      community.docker.docker_container:
        name: nginx_proxy
        image: "umputun/nginx-le:latest"
        networks:
          - name: "{{ docker_network_name }}"
        env:
          TZ: "America/Chicago"
          LETSENCRYPT: "true"
          LE_EMAIL: "example@example.com"
          LE_FQDN: "vds4.online"
        ports:
          - 80:80/tcp
          - 443:443/tcp
        volumes:
          - /etc/nginx/conf.d:/etc/nginx/conf.d:rw
          - /etc/ssl:/etc/nginx/ssl:rw
        state: "started"
        restart_policy: "unless-stopped"
